<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SmartFIT Experience: Golf Grip Fitting</title>
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Inter Font -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; }
    .fade-enter { opacity: 0; transform: translateY(16px); }
    .fade-enter-active { opacity: 1; transform: translateY(0); transition: opacity 0.4s, transform 0.4s; }
    .fade-exit { opacity: 1; transform: translateY(0); }
    .fade-exit-active { opacity: 0; transform: translateY(-16px); transition: opacity 0.4s, transform 0.4s; }
    .transitioning { pointer-events: none; }
    /* Custom scrollbar for progress bar */
    ::-webkit-scrollbar { height: 6px; background: #e5e7eb; border-radius: 9999px; }
    ::-webkit-scrollbar-thumb { background: #4fd1c5; border-radius: 9999px; }
  </style>
</head>
<body class="bg-gradient-to-br from-green-50 to-blue-50 min-h-screen flex items-center justify-center">
  <div id="survey-root" class="w-full max-w-xl mx-auto p-2 sm:p-6">
    <!-- Survey will be rendered here by JS -->
  </div>
  <script>
    // --- Survey Data Structure ---
    // Each step is an object with type, question, options, etc.
    const gripModels = [
      "Golf Pride Tour Velvet", "Lamkin Crossline", "SuperStroke Traxion", "Winn Dri-Tac", "Golf Pride MCC", "Golf Pride ZGRIP", "Lamkin Sonar", "Winn Excel", "SuperStroke S-Tech"
    ];
    const shotShapeLabels = [
      "Pull hook", "Hook", "Pull", "Draw", "Straight", "Push", "Slice", "Push Slice"
    ];
    const surveySteps = [
      // 0: Welcome
      { type: 'welcome',
        title: 'SmartFIT Experience: Golf Grip Fitting',
        message: 'Welcome to the SmartFIT Experience. The most comprehensive and advanced grip fitting technology available to golfers.'
      },
      // 1: Section 1 Intro
      { type: 'section',
        title: 'Player Profile',
        message: 'In this section, we’ll learn about your player profile. This section helps us understand your general golfing background.'
      },
      // 2: Age
      { type: 'radio',
        question: 'What is your age?',
        name: 'age',
        required: true,
        options: [
          'Under 18', '18-24', '25-34', '35-44', '45-54', '55-64', '65+'
        ]
      },
      // 3: Gender
      { type: 'radio',
        question: 'What is your gender?',
        name: 'gender',
        required: true,
        options: [
          'Male', 'Female', 'Prefer not to say'
        ]
      },
      // 4: Handicap
      { type: 'slider',
        question: 'What is your handicap?',
        name: 'handicap',
        required: true,
        min: 0, max: 21, step: 5, value: 10,
        labels: ['Scratch to 4', '5-9', '10-14', '15-20', '21+']
      },
      // 5: Rounds per year
      { type: 'slider',
        question: 'How many rounds a year do you play?',
        name: 'rounds',
        required: true,
        min: 5, max: 80, step: 5, value: 40
      },
      // 6: Grip size
      { type: 'radio',
        question: 'What size are your current grips? (If you know)',
        name: 'gripSize',
        required: true,
        options: [
          'Undersize', 'Standard', 'Midsize', 'Jumbo', "I don't know"
        ]
      },
      // 7: Grip model
      { type: 'autocomplete',
        question: 'What model(s) are your current grips? (If you know)',
        name: 'gripModel',
        required: false,
        options: gripModels
      },
      // 8: Section 2 Intro
      { type: 'section',
        title: 'Physical Considerations & Grip Preferences',
        message: 'Now, tell us about any physical considerations and grip preferences. This help us understand any physical factors that may affect your grip recommendation.'
      },
      // 9: Physical conditions
      { type: 'checkbox',
        question: 'Do you experience any of the following?',
        name: 'physical',
        required: true,
        options: [
          'Arthritis', 'Limited Hand Strength', 'Tendinitis', 'None of the above'
        ]
      },
      // 10: Moisture control
      { type: 'radio',
        question: 'Do your grips need to help with moisture control?',
        name: 'moisture',
        required: true,
        options: [
          'Yes, I struggle with slippage', 'No, moisture isn’t an issue'
        ]
      },
      // 11: Grip feel
      { type: 'radio',
        question: 'How would you describe your current grip’s feel?',
        name: 'feel',
        required: true,
        options: [
          'Too soft', 'Slightly soft', 'Just right', 'Slightly firm', 'Too firm'
        ]
      },
      // 12: Swing hand
      { type: 'radio',
        question: 'Which hand do you swing with?',
        name: 'swingHand',
        required: true,
        options: [
          'Left', 'Right'
        ],
        default: 'Right'
      },
      // 13: Iron shot shape
      { type: 'shotshape',
        question: 'What’s your typical iron shot shape?',
        name: 'ironShape',
        required: true,
        labels: shotShapeLabels,
        default: 4 // Straight
      },
      // 14: Driver shot shape
      { type: 'shotshape',
        question: 'What’s your typical driver shot shape?',
        name: 'driverShape',
        required: true,
        labels: shotShapeLabels,
        default: 4 // Straight
      },
      // 15: Section 3 Intro
      { type: 'section',
        title: 'Goals',
        message: 'Lastly, tell us about your goals. Tell us what you want to improve with your new grips.'
      },
      // 16: Change iron shape
      { type: 'radio',
        question: 'Do you want to change your iron shot shape?',
        name: 'goalIron',
        required: true,
        options: [
          'Yes, I want straighter shots', 'Yes, I want to draw it more', 'Yes, I want to fade it more', 'No, I like my current shape'
        ]
      },
      // 17: Change driver shape
      { type: 'radio',
        question: 'Do you want to change your driver shot shape?',
        name: 'goalDriver',
        required: true,
        options: [
          'Yes, I want straighter shots', 'Yes, I want to draw it more', 'Yes, I want to fade it more', 'No, I like my current shape'
        ]
      },
      // 18: Improve grip goals
      { type: 'checkbox',
        question: 'What do you want to improve with your new grips?',
        name: 'improve',
        required: true,
        options: [
          'Better fit', 'Better club control', 'Improved feel and feedback', 'Better grip in wet conditions', 'More comfort', 'Less hand fatigue'
        ]
      },
      // 19: Thank you
      { type: 'thankyou',
        title: 'Thank you for completing the SmartFIT Experience!',
        message: 'Your personalized grip recommendation will appear here shortly!'
      }
    ];

    // --- Survey State ---
    let currentStep = 0;
    let answers = {};
    let transitioning = false;

    // --- Utility Functions ---
    function $(sel) { return document.querySelector(sel); }
    function $all(sel) { return Array.from(document.querySelectorAll(sel)); }
    function sleep(ms) { return new Promise(r => setTimeout(r, ms)); }

    // --- Render Functions ---
    function renderProgress() {
      // Progress bar or "Question X of Y"
      if (currentStep === 0 || surveySteps[currentStep].type === 'thankyou') return '';
      const totalQuestions = surveySteps.filter(s => ['radio','slider','checkbox','autocomplete','shotshape'].includes(s.type)).length;
      const currentQuestion = surveySteps.slice(0, currentStep+1).filter(s => ['radio','slider','checkbox','autocomplete','shotshape'].includes(s.type)).length;
      return `<div class="w-full flex items-center mb-6">
        <div class="flex-1 h-2 bg-gray-200 rounded-full overflow-hidden mr-4">
          <div class="h-2 bg-teal-400 rounded-full transition-all" style="width: ${(currentQuestion/totalQuestions)*100}%"></div>
        </div>
        <span class="text-sm text-gray-500">Question ${currentQuestion} of ${totalQuestions}</span>
      </div>`;
    }

    function renderSection(title, message) {
      return `<div class="rounded-2xl bg-gradient-to-br from-green-100 to-blue-100 p-8 text-center shadow mb-8 animate-fadein">
        <h2 class="text-2xl font-bold text-teal-600 mb-2">${title}</h2>
        <p class="text-gray-700 text-lg">${message}</p>
        <button class="mt-8 px-8 py-3 rounded-xl bg-teal-500 text-white font-semibold text-lg shadow hover:bg-teal-600 transition" id="next-btn">Continue</button>
      </div>`;
    }

    function renderWelcome(title, message) {
      return `<div class="rounded-2xl bg-white p-8 text-center shadow-lg mb-8 animate-fadein">
        <h1 class="text-3xl sm:text-4xl font-extrabold text-teal-600 mb-4">${title}</h1>
        <p class="text-gray-700 text-lg mb-8">${message}</p>
        <button class="px-10 py-4 rounded-xl bg-blue-500 text-white font-semibold text-lg shadow hover:bg-blue-600 transition" id="next-btn">Start</button>
      </div>`;
    }

    function renderThankYou(title, message) {
      return `<div class="rounded-2xl bg-white p-8 text-center shadow-lg animate-fadein">
        <h2 class="text-3xl font-bold text-teal-600 mb-4">${title}</h2>
        <p class="text-gray-700 text-lg mb-8">${message}</p>
      </div>`;
    }

    function renderRadio(step, value) {
      return `<form class="space-y-4 animate-fadein">
        <h2 class="text-xl font-semibold text-gray-800 mb-6">${step.question}</h2>
        ${step.options.map(opt => `
          <label class="block cursor-pointer rounded-xl border border-gray-200 px-6 py-4 flex items-center gap-3 hover:border-teal-400 transition ${value===opt?'bg-teal-50 border-teal-400':''}">
            <input type="radio" name="${step.name}" value="${opt}" class="form-radio h-5 w-5 text-teal-500" ${value===opt?'checked':''}>
            <span class="text-lg">${opt}</span>
          </label>
        `).join('')}
      </form>`;
    }

    function renderCheckbox(step, value=[]) {
      return `<form class="space-y-4 animate-fadein">
        <h2 class="text-xl font-semibold text-gray-800 mb-6">${step.question}</h2>
        ${step.options.map(opt => `
          <label class="block cursor-pointer rounded-xl border border-gray-200 px-6 py-4 flex items-center gap-3 hover:border-teal-400 transition ${value.includes(opt)?'bg-teal-50 border-teal-400':''}">
            <input type="checkbox" name="${step.name}" value="${opt}" class="form-checkbox h-5 w-5 text-teal-500" ${value.includes(opt)?'checked':''}>
            <span class="text-lg">${opt}</span>
          </label>
        `).join('')}
      </form>`;
    }

    function renderSlider(step, value) {
      let labels = step.labels || [];
      let label = '';
      if (labels.length) {
        // Map value to label
        const idx = Math.floor((value-step.min)/(step.max-step.min)*((labels.length-1)||1));
        label = `<div class="text-teal-600 font-semibold text-lg mb-2">${labels[idx]}</div>`;
      }
      return `<form class="animate-fadein">
        <h2 class="text-xl font-semibold text-gray-800 mb-6">${step.question}</h2>
        ${label}
        <input type="range" min="${step.min}" max="${step.max}" step="${step.step}" value="${value}" name="${step.name}" class="w-full accent-teal-500 h-2 rounded-lg mb-2">
        <div class="flex justify-between text-sm text-gray-500">
          <span>${step.min}</span><span>${step.max}</span>
        </div>
      </form>`;
    }

    function renderAutocomplete(step, value) {
      return `<form class="animate-fadein">
        <h2 class="text-xl font-semibold text-gray-800 mb-6">${step.question}</h2>
        <div class="relative mb-2">
          <input type="text" name="${step.name}" id="grip-model-input" autocomplete="off" class="w-full border border-gray-300 rounded-xl p-4 text-lg focus:border-teal-400 focus:ring-2 focus:ring-teal-100 transition" placeholder="Type to search..." value="${value||''}" ${answers['gripModelUnknown']?'disabled':''}>
          <div id="grip-model-suggestions" class="absolute left-0 right-0 bg-white border border-gray-200 rounded-xl shadow z-10 mt-1"></div>
        </div>
        <label class="inline-flex items-center gap-2 cursor-pointer select-none">
          <input type="checkbox" id="grip-model-unknown" ${answers['gripModelUnknown']?'checked':''}>
          <span class="text-gray-700">I don't know</span>
        </label>
      </form>`;
    }

    function renderShotShape(step, value, swingHand, inactive=true) {
      // SVG arc diagram with marker and overlay
      const labels = step.labels;
      const n = labels.length-1;
      const idx = value;
      // Arc math
      const cx=150, cy=150, r=100;
      const angle = (i) => 180 - (i*180/n);
      const pos = (i) => {
        const a = angle(i)*Math.PI/180;
        return {x: cx + r*Math.cos(a), y: cy - r*Math.sin(a)};
      };
      // Marker position
      const marker = pos(idx);
      // Flip for left hand
      const flip = swingHand==='Left' ? -1 : 1;
      // Overlay
      const overlay = inactive ? `<div class="absolute inset-0 bg-white bg-opacity-80 flex items-center justify-center text-gray-400 text-lg font-medium rounded-2xl z-10 pointer-events-auto">Move the slider to see shot shape</div>` : '';
      return `<form class="animate-fadein">
        <h2 class="text-xl font-semibold text-gray-800 mb-6">${step.question}</h2>
        <div class="relative mb-6">
          <div class="rounded-2xl overflow-hidden border border-gray-200 bg-gray-50" style="width:300px;height:180px;margin:auto;">
            <div class="relative w-full h-full" style="width:300px;height:180px;">
              <svg width="300" height="180" viewBox="0 0 300 180">
                <path d="M50,150 A100,100 0 0,0 250,150" stroke="#4B5563" stroke-width="2" fill="none" />
                ${labels.map((lbl,i) => {
                  const p = pos(i);
                  return `<text x="${p.x}" y="${p.y-10}" text-anchor="middle" font-size="11" fill="#4B5563">${lbl}</text>`;
                }).join('')}
                <circle cx="${marker.x}" cy="${marker.y}" r="8" fill="#14b8a6" stroke="#fff" stroke-width="3" />
              </svg>
              ${overlay}
            </div>
          </div>
        </div>
        <input type="range" min="0" max="${n}" step="1" value="${value}" name="${step.name}" class="w-full accent-teal-500 h-2 rounded-lg mb-2" ${inactive?'tabindex="-1"':''}>
        <div class="text-center text-teal-600 font-semibold text-lg mt-2">${labels[value]}</div>
      </form>`;
    }

    // --- Main Render Function ---
    async function renderSurvey() {
      const root = document.getElementById('survey-root');
      const step = surveySteps[currentStep];
      let html = '';
      html += renderProgress();
      if (step.type === 'welcome') html += renderWelcome(step.title, step.message);
      else if (step.type === 'section') html += renderSection(step.title, step.message);
      else if (step.type === 'thankyou') html += renderThankYou(step.title, step.message);
      else if (step.type === 'radio') html += renderRadio(step, answers[step.name]);
      else if (step.type === 'checkbox') html += renderCheckbox(step, answers[step.name]||[]);
      else if (step.type === 'slider') html += renderSlider(step, answers[step.name] ?? step.value);
      else if (step.type === 'autocomplete') html += renderAutocomplete(step, answers[step.name]);
      else if (step.type === 'shotshape') html += renderShotShape(step, answers[step.name] ?? step.default, answers['swingHand']||'Right', !answers[step.name+'Active']);
      // Navigation
      html += `<div class="flex justify-between mt-8">
        <button id="back-btn" class="px-6 py-3 rounded-xl bg-gray-200 text-gray-700 font-semibold shadow hover:bg-gray-300 transition ${currentStep===0?'opacity-0 pointer-events-none':''}">Back</button>
        <button id="next-btn" class="px-8 py-3 rounded-xl bg-teal-500 text-white font-semibold shadow hover:bg-teal-600 transition">${step.type==='thankyou'?'':'Continue'}</button>
      </div>`;
      root.innerHTML = html;
      // Animate in
      root.classList.add('fade-enter');
      await sleep(10); root.classList.add('fade-enter-active');
      await sleep(400); root.classList.remove('fade-enter','fade-enter-active');
      // Setup events
      setupEvents();
    }

    // --- Event Handlers ---
    function setupEvents() {
      const step = surveySteps[currentStep];
      // Next/Back
      $('#next-btn')?.addEventListener('click', async (e) => {
        e.preventDefault();
        if (transitioning) return;
        if (!validateStep()) return;
        transitioning = true;
        await animateOut();
        currentStep = Math.min(currentStep+1, surveySteps.length-1);
        await renderSurvey();
        transitioning = false;
      });
      $('#back-btn')?.addEventListener('click', async (e) => {
        e.preventDefault();
        if (transitioning) return;
        transitioning = true;
        await animateOut();
        currentStep = Math.max(currentStep-1, 0);
        await renderSurvey();
        transitioning = false;
      });
      // Radio
      $all('input[type=radio]').forEach(radio => {
        radio.addEventListener('change', e => {
          answers[radio.name] = radio.value;
          if (step.type==='radio') validateStep();
        });
      });
      // Checkbox
      $all('input[type=checkbox]').forEach(cb => {
        cb.addEventListener('change', e => {
          if (cb.id==='grip-model-unknown') {
            answers['gripModelUnknown'] = cb.checked;
            if (cb.checked) answers['gripModel'] = '';
            renderSurvey();
            return;
          }
          const vals = $all(`input[name="${cb.name}"]:checked`).map(c=>c.value);
          answers[cb.name] = vals;
          validateStep();
        });
      });
      // Slider
      $all('input[type=range]').forEach(slider => {
        slider.addEventListener('input', e => {
          answers[slider.name] = parseInt(slider.value,10);
          renderSurvey();
        });
        slider.addEventListener('focus', e => {
          // For shotshape, activate diagram
          if (step.type==='shotshape') {
            answers[step.name+'Active'] = true;
            renderSurvey();
          }
        });
      });
      // Autocomplete
      if ($('#grip-model-input')) {
        $('#grip-model-input').addEventListener('input', e => {
          const val = e.target.value;
          answers['gripModel'] = val;
          showGripModelSuggestions(val);
        });
        $('#grip-model-input').addEventListener('focus', e => {
          showGripModelSuggestions(e.target.value);
        });
        $('#grip-model-input').addEventListener('blur', e => {
          setTimeout(()=>{
            $('#grip-model-suggestions').innerHTML = '';
          }, 200);
        });
      }
    }

    function showGripModelSuggestions(val) {
      const sug = $('#grip-model-suggestions');
      if (!val) { sug.innerHTML = ''; return; }
      const matches = gripModels.filter(m => m.toLowerCase().includes(val.toLowerCase()));
      sug.innerHTML = matches.map(m => `<div class="px-4 py-2 cursor-pointer hover:bg-teal-50 rounded" onclick="document.getElementById('grip-model-input').value='${m}';document.getElementById('grip-model-suggestions').innerHTML='';answers['gripModel']='${m}';">${m}</div>`).join('');
    }

    // --- Validation ---
    function validateStep() {
      const step = surveySteps[currentStep];
      let valid = true;
      let errorMsg = '';
      if (step.required) {
        if (step.type==='radio' && !answers[step.name]) valid = false;
        if (step.type==='checkbox' && (!answers[step.name] || answers[step.name].length===0)) valid = false;
        if (step.type==='slider' && (answers[step.name]===undefined || answers[step.name]===null)) valid = false;
        if (step.type==='autocomplete' && !answers['gripModel'] && !answers['gripModelUnknown']) valid = false;
        if (step.type==='shotshape' && (answers[step.name]===undefined || answers[step.name]===null)) valid = false;
      }
      // Show error
      if (!valid) {
        if (!$('#survey-error')) {
          const err = document.createElement('div');
          err.id = 'survey-error';
          err.className = 'mt-4 text-red-500 text-center text-base font-medium animate-fadein';
          err.textContent = 'Please answer before continuing.';
          $('#survey-root').appendChild(err);
        }
      } else {
        if ($('#survey-error')) $('#survey-error').remove();
      }
      return valid;
    }

    // --- Animation ---
    async function animateOut() {
      const root = document.getElementById('survey-root');
      root.classList.add('fade-exit');
      await sleep(10); root.classList.add('fade-exit-active');
      await sleep(400); root.classList.remove('fade-exit','fade-exit-active');
    }

    // --- Start Survey ---
    renderSurvey();
  </script>
</body>
</html> 